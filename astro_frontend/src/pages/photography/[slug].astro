---
import Layout from "@/layouts/Layout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const albums = await getCollection("albums", ({ data }) => !data.draft);
  return albums.map((album) => ({
    params: { slug: album.slug },
    props: { slug: album.slug },
  }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("albums", slug);

if (!entry) {
  throw new Error(`Album entry not found for slug: ${slug}`);
}

const { Content } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.description}>
  <section class="section">
    <div class="container">
      <div class="section-card">
        <header style="display: flex; justify-content: space-between; align-items: baseline; gap: 1rem; margin-bottom: 1.25rem;">
          <div>
            <p class="tag" style="display: inline-block; margin-bottom: 0.5rem;">Album</p>
            <h1 style="margin: 0;">
              {entry.data.title}
              {entry.slug.startsWith("demo-") && <span class="tag" style="margin-left: 0.5rem;">DEMO</span>}
            </h1>
            <p style="color: var(--color-text-secondary); margin: 0.35rem 0 0;">
              {entry.data.description}
            </p>
          </div>
          <time datetime={entry.data.date.toISOString()} style="color: var(--color-text-secondary);">
            {entry.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
          </time>
        </header>

        <article class="prose">
          <Content />
        </article>
      </div>
    </div>
  </section>
</Layout>

