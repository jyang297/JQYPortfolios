---
import Layout from "@/layouts/Layout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const agents = await getCollection("agents", ({ data }) => !data.draft);
  return agents.map((agent) => ({
    params: { slug: agent.slug },
    props: { slug: agent.slug },
  }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("agents", slug);

if (!entry) {
  throw new Error(`Agent entry not found for slug: ${slug}`);
}

const { Content } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.description}>
  <section class="section">
    <div class="container">
      <div class="section-card">
        <header style="display: flex; justify-content: space-between; align-items: baseline; gap: 1rem; margin-bottom: 1.25rem;">
          <div>
            <p class="tag" style="display: inline-block; margin-bottom: 0.5rem;">AI Agent</p>
            <h1 style="margin: 0;">
              {entry.data.title}
              {entry.slug.startsWith("demo-") && <span class="tag" style="margin-left: 0.5rem;">DEMO</span>}
            </h1>
            <p style="color: var(--color-text-secondary); margin: 0.35rem 0 0;">
              {entry.data.description}
            </p>
          </div>
          <time datetime={entry.data.date.toISOString()} style="color: var(--color-text-secondary);">
            {entry.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
          </time>
        </header>

        {entry.data.technologies && (
          <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
            {entry.data.technologies.map((tech) => (
              <span class="tag tag-accent">{tech}</span>
            ))}
          </div>
        )}

        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1.25rem;">
          <span class="tag" style="background: var(--color-surface-2);">{entry.data.status}</span>
          {entry.data.github && (
            <a href={entry.data.github} target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="padding: 0.35rem 0.75rem;">
              GitHub
            </a>
          )}
          {entry.data.demo && (
            <a href={entry.data.demo} target="_blank" rel="noopener noreferrer" class="btn btn-ghost" style="padding: 0.35rem 0.75rem;">
              Demo
            </a>
          )}
        </div>

        <article class="prose">
          <Content />
        </article>
      </div>
    </div>
  </section>
</Layout>

